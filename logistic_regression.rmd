---
title: "Logistic Regression Tutorial"
author: "Ozan Aygun"
date: "6/04/2017"
output: 
   html_document:
        toc: true
        number_sections: true
        depth: 4
        theme: cerulean
        highlight: tango
        df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,results = "markup", fig.align = "center", fig.width = 5, fig.height = 4,message=FALSE,warning=FALSE)
```

We will use the Smarket data set from ISLR package. This data represents daily percentage returns for the S&P 500 stock index between 2001 and 2005.

#Basic exploration of the data

```{r,fig.width = 10, fig.height = 10}
require(ISLR)
names(Smarket)
str(Smarket)
summary(Smarket)
library(knitr)
knitr::kable(head(Smarket),align = "c")
plot(Smarket[,-9], col = ifelse(Smarket$Direction == "Up","green","red"), cex = 0.5, pch = 20)
```

We are going to predict the direction of the market (up or down) given the features available. Note that the response variable Direction is derived from the Today variable, therefore we will not include this variable in our model.

# Fitting the Logistic regression model

```{r}
glm.fit <- glm(Direction ~ Lag1 + Lag2 + Lag3 + Lag4+ Lag5+ Volume, data = Smarket, family = "binomial")
summary(glm.fit)
```

Note that none of the features appear significant from this model. Not surprising for the stock market data, it also looked fairly noisy without much correlation with the response.

**This doesn't mean we can not make predictions by using this model!**

# Making predictions from a logistic regression model:

Using predict function to get probabilities using the training data we used to fit the model:

```{r}
glm.probs <- predict(glm.fit,type = "response")
glm.probs[1:5] # Vector of the fitted probabilities
```

Note that all the predicted probabilities are close to 50%, another indication that we won't be able to make strong predictions using this model.

# Turning probabilities into classifications

```{r}
glm.pred <- ifelse(glm.probs > 0.5, "Up", "Down")
```

# Prepare confusionMatrix

- Diagonal: the values our model got right.
- Off-diagonal: the values our model missed.

```{r}
knitr::kable(table(glm.pred,Smarket$Direction), align = "c")
```

# Calculating the mean performance of the model

